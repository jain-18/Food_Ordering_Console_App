package com.foodapp.beforeLoginMenu;

import java.util.Scanner;

import com.foodapp.DBOperation.DataBaseOperation;
import com.foodapp.entity.User;

public class RegisterCustomer {
	Scanner scanner;

	public RegisterCustomer(Scanner scanner) {
		this.scanner = scanner;
	}

	public User register() {
		System.out.println("\n------ Registration ------");

		String firstName = correctName("First name");
		String lastName = correctName("Last name");

		String address = inputNonEmpty("Address");

		String email = inputEmail();
		String mobile = inputMobile();
		String password = inputPassword();

		// Create and set the user object
		User user = new User();
		user.setFirstName(firstName);
		user.setLastName(lastName);
		user.setAddress(address);
		user.setEmailId(email);
		user.setMobileNo(mobile);
		user.setPassword(password);

		System.out.println("✅ Registration successful!");
		return user;
	}

	private String correctName(String fieldName) {
		while (true) {
			System.out.print("Enter " + fieldName + " (no spaces): ");
			String input = scanner.nextLine();
			if (input != null && input.matches("^[A-Za-z]+$")) {
				return input;
			} else {
				System.out.println("❌ Invalid " + fieldName + ". Only alphabets allowed.");
			}
		}
	}

	private String inputNonEmpty(String fieldName) {
		while (true) {
			System.out.print("Enter " + fieldName + ": ");
			String input = scanner.nextLine();
			if (!input.trim().isEmpty()) {
				return input;
			} else {
				System.out.println("❌ " + fieldName + " cannot be empty.");
			}
		}
	}

	private String inputEmail() {
		while (true) {
			System.out.print("Enter Email: ");
			String email = scanner.nextLine();
			if (email.matches("^[\\w.-]+@[\\w.-]+\\.\\w{2,}$")) {
				if (DataBaseOperation.emailExists(email)) {
					return email;
				}
			} else {
				System.out.println("❌ Invalid email format.");
			}
		}
	}

	private String inputMobile() {
		while (true) {
			System.out.print("Enter Mobile No (10 digits): ");
			String mobile = scanner.nextLine();
			if (mobile.matches("^[6-9]\\d{9}$")) {
				return mobile;
			} else {
				System.out.println("❌ Invalid mobile number. Must start with 6-9 and be 10 digits.");
			}
		}
	}

	private String inputPassword() {
		while (true) {
			System.out.print("Enter Password (min 6 chars): ");
			String pwd = scanner.nextLine();
			if (pwd.length() >= 6) {
				return pwd;
			} else {
				System.out.println("❌ Password must be at least 6 characters.");
			}
		}
	}
}
